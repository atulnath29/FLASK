{% extends "base.html" %}
{% block title %}Products — CRM System{% endblock %}
{% block extra_css %}<link rel="stylesheet" href="{{ url_for('static', filename='css/pages.css') }}">{% endblock %}

{% block content %}
<div class="page-header">
  <div class="header-content">
    <h1>Products</h1>
    <p>Manage your inventory and product catalog</p>
  </div>
  <div class="header-actions">
    <a href="{{ url_for('add_product') }}" class="btn btn-primary">+ Add Product</a>
  </div>
</div>

{% set low_items = products | selectattr('qty', 'lt', 5) | selectattr('status', 'equalto', 'active') | list %}
{% if low_items %}
<div class="low-stock-alert">
  ⚠️ <strong>{{ low_items|length }} item(s) low on stock</strong> — please restock soon.
</div>
{% endif %}

<div class="products-table-wrap">
  {% if products %}
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>#</th><th>Product</th><th>Category</th><th>Price</th>
          <th>Tax %</th><th>Stock</th><th>Status</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in products %}
        <tr>
          <td style="color:#6b7280;font-size:0.8rem">{{ p.id }}</td>
          <td><strong>{{ p.name }}</strong></td>
          <td>{{ p.category }}</td>
          <td><strong>${{ "%.2f"|format(p.price) }}</strong></td>
          <td>{{ p.tax }}%</td>
          <td>
            <span class="stock-badge {% if p.qty == 0 %}stock-out{% elif p.qty < 5 %}stock-low{% else %}stock-ok{% endif %}">
              {{ p.qty }} units
            </span>
          </td>
          <td>
            <span class="status-{{ p.status }}">{{ p.status.title() }}</span>
          </td>
          <td>
            <div class="action-btns">
              <a href="{{ url_for('edit_product', pid=p.id) }}" class="btn btn-sm btn-warning">Edit</a>
              <form method="POST" action="{{ url_for('delete_product', pid=p.id) }}" style="display:inline" onsubmit="return confirm('Delete {{ p.name }}?')">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <div style="text-align:center;padding:50px;color:#6b7280">
    <p style="font-size:1.1rem">No products yet.</p>
    <a href="{{ url_for('add_product') }}" class="btn btn-primary" style="margin-top:12px">Add First Product</a>
  </div>
  {% endif %}
</div>
{% endblock %}
